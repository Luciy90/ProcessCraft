# Краткие инструкции по интеграции динамической загрузки модулей

## Шаги для миграции

### 1. Отключение старой статической регистрации
В `app.js` замените метод `initializeModules()` на вызов динамического загрузчика

### 2. Создание нового модуля
```bash
# 1. Создайте файл модуля
touch src/renderer/js/modules/новый-модуль.js

# 2. Используйте шаблон класса
# 3. Добавьте export default НовыйМодульModule
# 4. Добавьте window.НовыйМодульModule = НовыйМодульModule

# 5. Опционально: создайте .meta.json
touch src/renderer/js/modules/новый-модуль.meta.json

# 6. index.json обновляется автоматически при сборке
```

### 3. Проверка moduleId
Убедитесь что moduleId соответствует паттерну: `^[a-z0-9-_]+$`

### 4. Тестирование
```javascript
// В консоли браузера
console.table(window.listModules())  // Список модулей
window.getModule('orders')           // Информация о модуле
window.app.switchModule('orders')    // Переключение модуля
```

## Debug checklist

- [ ] Контейнер модуля существует: `<div id="модуль-module">`
- [ ] Навигация настроена: `[data-module="модуль"]`  
- [ ] Модуль экспортирован: `export default Module; window.Module = Module`
- [ ] index.json обновляется автоматически (для браузера)
- [ ] Нет ошибок в консоли
- [ ] moduleId валиден (только a-z, 0-9, -, _)

## Добавление нового модуля за 5 минут

1. **Создать модуль**: `cp orders.js новый.js`
2. **Изменить класс**: `class НовыйModule` 
3. **Обновить moduleId**: `this.moduleId = 'новый'`
4. **index.json обновится автоматически при следующей сборке**
5. **Тест**: `window.app.switchModule('новый')`

## Параметры loadModules()

```javascript
await loadModules({
    path: 'js/modules',    // папка модулей
    dev: true,             // детальные логи  
    lazyLoad: false        // инициализация сразу
});
```

## Hot-reload (только Electron dev)

- Автоматически отслеживает изменения файлов
- Перезагружает модуль без перезапуска приложения
- Работает только в dev режиме с `dev: true`

## Автоматическая пересборка index.json

Система теперь автоматически пересобирает `index.json` при каждой сборке проекта.
Файл генерируется скриптом `scripts/build-module-index.js` и содержит актуальный список всех модулей.

Для ручного запуска пересборки:
```bash
npm run build:modules
```

## Безопасность

- Валидация moduleId: только `[a-z0-9-_]`
- Блокировка путей с `..`
- Импорт только из `js/modules/`
- Изоляция ошибок между модулями

## Новые возможности

### Динамическая загрузка модулей
- Автоматическое обнаружение модулей в папке `src/renderer/js/modules/`
- Поддержка метаданных через `.meta.json` файлы
- Совместимость с существующими модулями

### Улучшенная система пользователей
- Поддержка аватаров и фоновых изображений
- Централизованное хранение пользовательских данных
- Улучшенная система аутентификации

### Расширенная отладка
- Детальные логи в режиме разработки
- Инструменты для диагностики проблем с модулями
- Мониторинг состояния модулей в реальном времени