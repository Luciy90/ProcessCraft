# Настройка подключения к базе данных

Этот документ объясняет, как настроить и сконфигурировать подключение к базе данных для ProcessCraft.

## Обзор

ProcessCraft использует Microsoft SQL Server в качестве сервера базы данных. Подключение управляется через пул подключений для оптимизации производительности и использования ресурсов.

## Конфигурация

### Переменные окружения

Подключение к базе данных настраивается с помощью переменных окружения. Создайте файл `.env` в корневой директории проекта на основе шаблона [.env.example](file:///c%3A/Users/KodochigovV/Documents/Projects/ProcessCraft/.env.example):

```
DB_USER=ProcessCraft
DB_PASSWORD=ProcessCraftPassword
DB_SERVER=OZO-62\SQLEXPRESS
DB_DATABASE=ProcessCraftDB
```

### Настройки пула подключений

Пул подключений сконфигурирован со следующими параметрами:
- Максимум подключений: 10
- Минимум подключений: 0
- Таймаут простоя: 30000 миллисекунд (30 секунд)
- Шифрование: Отключено (требуется для совместимости с SQL Server 2008)

## Детали реализации

### Файл подключения

Подключение к базе данных реализовано в [src/db/connection.js](file:///c%3A/Users/KodochigovV/Documents/Projects/ProcessCraft/src/db/connection.js):

1. Загружает переменные окружения с помощью dotenv
2. Создает объект конфигурации с деталями подключения
3. Настраивает пул подключений с указанными параметрами
4. Проверяет подключение с помощью тестового запроса
5. Экспортирует пул и библиотеку sql для использования в других модулях

### Использование в модулях приложения

Чтобы использовать подключение к базе данных в ваших модулях:

```javascript
const { poolPromise } = require('../db/connection');

// Выполнить запрос
poolPromise.then(pool => {
  return pool.request()
    .query('SELECT * FROM users WHERE id = @id', (err, result) => {
      // Обработка результата
    });
});
```

## Тестирование подключения

Чтобы протестировать подключение к базе данных, выполните:

```bash
node src/db/test-connection.js
```

Этот скрипт будет:
1. Пытаться подключиться к базе данных
2. Выполнять простой запрос для проверки подключения
3. Отображать результаты или любые возникшие ошибки

## Устранение неполадок

### Частые проблемы

1. **Таймаут подключения**: Проверьте, запущен ли SQL Server и доступен ли он
2. **Ошибка аутентификации**: Проверьте имя пользователя и пароль в файле .env
3. **База данных не найдена**: Убедитесь, что база данных существует на сервере

### Сообщения об ошибках

- "Database connection failed": Проверьте адрес сервера и сетевое подключение
- "Login failed for user": Проверьте учетные данные в файле .env
- "Database 'ProcessCraftDB' does not exist": Создайте базу данных на вашем экземпляре SQL Server

## Соображения безопасности

1. Никогда не фиксируйте файл `.env` в системе контроля версий
2. Используйте надежные пароли для учетных записей базы данных
3. Ограничьте разрешения базы данных только тем, что необходимо для приложения
4. В производственной среде рассмотрите возможность включения шифрования, если используется более новая версия SQL Server