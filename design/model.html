<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Settings Modal</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark; }
  </style>
</head>

<body class="bg-neutral-950 text-neutral-100 font-sans tracking-tight" style="font-family: Inter, ui-sans-serif, system-ui">
  <!-- entry button (пример интеграции в сайдбар) -->
  <button id="sidebar-settings" class="fixed bottom-6 right-6 h-11 px-4 rounded-lg border border-white/10 bg-white/[0.06] hover:bg-white/10 transition-colors flex items-center gap-2 z-40">
    <svg data-lucide="settings" class="h-5 w-5"></svg>
    Параметры
  </button>

  <!-- root modal overlay -->
  <div id="settingsModal" class="settings-modal fixed inset-0 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="settings-title">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

    <!-- modal-content -->
    <div class="modal-content relative mx-auto my-auto w-[min(95vw,1100px)] max-w-[1100px] flex flex-col gap-6 rounded-xl border border-white/10 bg-neutral-900 shadow-xl p-6">
      <header class="flex items-center justify-between">
        <h2 id="settings-title" class="text-xl font-semibold tracking-tight">Настройки доступа</h2>
        <button id="closeModal" class="h-9 w-9 grid place-items-center rounded-lg hover:bg-white/10 transition-colors">
          <svg data-lucide="x" class="h-5 w-5"></svg>
        </button>
      </header>

      <!-- columns -->
      <div class="columns grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- users column -->
        <section class="col users flex flex-col">
          <h3 class="text-lg font-medium tracking-tight mb-3 flex items-center gap-2">
            <svg data-lucide="users" class="h-5 w-5"></svg>
            Пользователи
          </h3>
          <div class="users-list-scroll flex-1 rounded-lg border border-white/10 bg-white/5 overflow-y-auto max-h-[50vh] divide-y divide-white/10">
            <!-- заполнится скриптом -->
          </div>
        </section>

        <!-- modules column -->
        <section class="col modules flex flex-col">
          <h3 class="text-lg font-medium tracking-tight mb-3 flex items-center gap-2">
            <svg data-lucide="boxes" class="h-5 w-5"></svg>
            Модули
          </h3>
          <div class="modules-list-scroll flex-1 rounded-lg border border-white/10 bg-white/5 overflow-y-auto max-h-[50vh] divide-y divide-white/10">
            <!-- заполнится скриптом -->
          </div>
        </section>
      </div>

      <!-- footer -->
      <footer class="flex justify-end gap-3 pt-2 border-t border-white/10">
        <button id="cancel" class="button-cancel h-9 px-4 rounded-lg border border-white/10 hover:bg-white/10 transition-colors">Отмена</button>
        <button id="apply" class="button-apply h-9 px-4 rounded-lg border border-emerald-400/40 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-200 transition-colors">Применить</button>
      </footer>
    </div>
  </div>

  <!-- scripts -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    const overlay       = document.getElementById('settingsModal');
    const openBtn       = document.getElementById('sidebar-settings');
    const closeBtn      = document.getElementById('closeModal');
    const cancelBtn     = document.getElementById('cancel');
    const usersScroll   = overlay.querySelector('.users-list-scroll');
    const modulesScroll = overlay.querySelector('.modules-list-scroll');

    const fakeFetch = () => new Promise(res => setTimeout(() => res({
      users: [
        'Алексей Смирнов',
        'Елена Иванова',
        'Дмитрий Кузнецов',
        'Мария Петрова'
      ],
      modules: [
        'Аналитика',
        'Отчёты',
        'Уведомления',
        'Администрирование'
      ]
    }), 200));

    const openModal = () => {
      overlay.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
      loadData();
    };

    const closeModal = () => {
      overlay.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    };

    const buildToggle = (extraClasses = '', inputClasses = '') => `
      <label class="inline-flex items-center cursor-pointer ${extraClasses}">
        <input type="checkbox" class="sr-only peer ${inputClasses}">
        <div class="w-10 h-5 bg-white/20 rounded-full peer-focus:ring-2 peer-focus:ring-emerald-400/40 peer-checked:bg-emerald-500 relative transition-colors">
          <span class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5"></span>
        </div>
      </label>
    `;

    const loadData = async () => {
      const { users, modules } = await fakeFetch();

      /* users */
      usersScroll.innerHTML = users.map(u => `
        <div class="p-4 hover:bg-white/5 transition-colors">${u}</div>
      `).join('');

      /* modules */
      modulesScroll.innerHTML = modules.map(m => `
        <div class="module-row p-4 flex items-center justify-between gap-4 hover:bg-white/5 transition-colors">
          <div class="flex items-center gap-3 min-w-0">
            <svg data-lucide="unlock" class="h-4 w-4 text-white/60 lock-indicator shrink-0"></svg>
            <span class="text-sm truncate">${m}</span>
          </div>
          <div class="flex items-center gap-3 shrink-0">
            ${buildToggle('', 'toggle-visible')}
            ${buildToggle('', 'toggle-lock')}
            ${buildToggle('', 'toggle-enable')}
          </div>
        </div>
      `).join('');

      lucide.createIcons({ attrs: { 'stroke-width': 1.5 } });

      /* lock icon reaction */
      modulesScroll.querySelectorAll('.module-row').forEach(row => {
        const lockToggle = row.querySelector('.toggle-lock');
        const lockIcon   = row.querySelector('.lock-indicator');

        lockToggle.addEventListener('change', () => {
          if (lockToggle.checked) {
            lockIcon.setAttribute('data-lucide', 'lock');
            lockIcon.classList.remove('text-white/60');
            lockIcon.classList.add('text-emerald-400');
          } else {
            lockIcon.setAttribute('data-lucide', 'unlock');
            lockIcon.classList.remove('text-emerald-400');
            lockIcon.classList.add('text-white/60');
          }
          lucide.createIcons({ attrs: { 'stroke-width': 1.5 } });
        });
      });
    };

    /* listeners */
    openBtn .addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);

    overlay.addEventListener('click', e => {
      if (e.target === overlay) closeModal();
    });

    window.addEventListener('keydown', e => {
      if (e.key === 'Escape' && !overlay.classList.contains('hidden')) closeModal();
    });

    /* initial icon render */
    document.addEventListener('DOMContentLoaded', () => lucide.createIcons({ attrs: { 'stroke-width': 1.5 } }));
  </script>
</body>
</html>